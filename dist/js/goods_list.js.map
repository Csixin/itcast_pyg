{"version":3,"sources":["goods_list.js"],"names":["$","sendDate","query","cid","getUrl","pagenum","pagesize","totalPages","aTap","on","target","href","console","log","location","mui","init","pullRefresh","container","down","auto","callback","muban","data","html","template","arr","endPulldownToRefresh","refresh","sendAjax","up","endPullupToRefresh","append","func","ajax","type","url","dataType","success","res","meta","status","Math","ceil","total","goods","name","reg","RegExp","r","window","search","substr","match","decodeURI"],"mappings":"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","sourcesContent":["$(function () {\r\n    //将要发送的数据作为全局变量，方便操作\r\n    let sendDate = {\r\n        query: \"\",\r\n        cid: getUrl(\"cid\"),\r\n        pagenum: \"1\",\r\n        pagesize: \"5\"\r\n    }\r\n    let totalPages;\r\n\r\n    //在mui框架上下拉组件中a默认没有跳转功能，需手动js安排跳转\r\n    aTap()\r\n    function aTap(){\r\n        $(\".list\").on(\"tap\",\"a\",function(){\r\n            let target = this.href;\r\n            console.log(target)\r\n            location.href = target;\r\n        })\r\n    }\r\n\r\n    mui.init({\r\n        pullRefresh: {\r\n            container: \".pyg_view\",\r\n            down: {\r\n                auto: true,\r\n                //  触发下拉刷新时自动触发\r\n                callback: function () {\r\n                    sendDate.pagenum = 1;\r\n                    //定义函数作为sendAjax的回调\r\n                    let muban = function (data) {\r\n                        let html = template(\"goodsTml\", {\r\n                            arr: data\r\n                        });\r\n                        $('.list').html(html);\r\n                        mui('.pyg_view').pullRefresh().endPulldownToRefresh();\r\n                        mui('.pyg_view').pullRefresh().refresh(true);\r\n                    }\r\n                    \r\n                    sendAjax(muban);\r\n                }\r\n            },\r\n            up: {\r\n                //  触发上拉刷新时自动触发\r\n                callback: function () {\r\n                    console.log(sendDate.pagenum);\r\n                    console.log(totalPages)\r\n                    if (sendDate.pagenum >= totalPages) {\r\n                        console.log(\"NO DATA\");\r\n                        mui(\".pyg_view\").pullRefresh().endPullupToRefresh(true);\r\n                    } else {\r\n                        console.log(\"还有数据\")\r\n                        sendDate.pagenum++;\r\n                        let muban = function (data) {\r\n                            let html = template(\"goodsTml\", {\r\n                                arr: data\r\n                            });\r\n                            //第二次时用append\r\n                            $('.list').append(html);\r\n                            mui(\".pyg_view\").pullRefresh().endPullupToRefresh(false);\r\n\r\n                        }\r\n                        sendAjax(muban);\r\n                        \r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    function sendAjax(func) {\r\n        $.ajax({\r\n            type: \"get\",\r\n            url: \"http://api.pyg.ak48.xyz/api/public/v1/goods/search\",\r\n            data: sendDate,\r\n            dataType: \"json\",\r\n            success: function (res) {\r\n                console.log(res);\r\n                if (res.meta.status == 200) {\r\n\r\n                    totalPages = Math.ceil(res.data.total / sendDate.pagesize);\r\n\r\n                    func(res.data.goods);\r\n\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n    //截取url的cid\r\n    function getUrl(name) {\r\n        var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n        var r = window.location.search.substr(1).match(reg);\r\n        if (r != null) return decodeURI(r[2]);\r\n        return null;\r\n    }\r\n\r\n})"],"file":"goods_list.js"}